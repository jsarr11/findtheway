<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play Kruskal</title>
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/custom-level.css">
    <script src="../node_modules/jquery/dist/jquery.min.js"></script>
    <script src="/js/language-switcher.js"></script>
</head>
<body>
<header>
    <button id="switch-lang">English</button>
</header>

<div class="game-container">
    <!-- Single cytoscape container not needed here, just a game menu -->
    <main>

        <!-- Greek Content -->
        <div id="content-el">
            <h1>Παίξε Kruskal</h1>
            <div class="button-row">
                <button onclick="window.location.href='/theory-kruskal'">Θεωρία</button>
                <button onclick="window.location.href='/tutorial-kruskal'">Οδηγός</button>
            </div>
            <div class="button-row">
                <button onclick="playGame('beginner')">Αρχάριος</button>
                <button onclick="playGame('intermediate')">Μέτριος</button>
                <button onclick="playGame('expert')">Προχωρημένος</button>
            </div>
            <div class="button-container">
                <button onclick="showCustomLevelPopup()">Δημιουργία Προσαρμοσμένου Επιπέδου</button>
            </div>
            <div class="button-container">
                <button onclick="window.location.href='/user-page'">Πίσω</button>
            </div>
        </div>

        <!-- English Content (hidden by default) -->
        <div id="content-en" style="display:none;">
            <h1>Play Kruskal</h1>
            <div class="button-row">
                <button onclick="window.location.href='/theory-kruskal'">Theory</button>
                <button onclick="window.location.href='/tutorial-kruskal'">Tutorial</button>
            </div>
            <div class="button-row">
                <button onclick="playGame('beginner')">Beginner</button>
                <button onclick="playGame('intermediate')">Intermediate</button>
                <button onclick="playGame('expert')">Expert</button>
            </div>
            <div class="button-container">
                <button onclick="showCustomLevelPopup()">Create Custom Level</button>
            </div>
            <div class="button-container">
                <button onclick="window.location.href='/user-page'">Back</button>
            </div>
        </div>
    </main>

    <!-- Custom Level Popup (shared, only text differs) -->
    <!-- To fully localize the popup, you could have two sets of elements, one for each language. -->
    <!-- For brevity, we'll keep a single popup and translate strings dynamically if needed. -->
    <div id="customLevelPopup" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCustomLevelPopup()">&times;</span>
            <!-- We'll assume the language is determined by reading localStorage and changing labels accordingly -->
            <h2 id="popup-title">Δημιουργία Προσαρμοσμένου Επιπέδου</h2>
            <label for="vertices" id="label-vertices">Αριθμός Κορυφών:</label>
            <input type="number" id="vertices" name="vertices" min="5" max="25" required onchange="updateEdgeConstraints()"><br>

            <label for="edges" id="label-edges">Αριθμός Ακμών:</label>
            <input type="number" id="edges" name="edges" min="3" required><br>

            <label for="minWeight" id="label-minWeight">Ελάχιστο Βάρος:</label>
            <input type="number" id="minWeight" name="minWeight" min="5" max="40" required><br>

            <label for="maxWeight" id="label-maxWeight">Μέγιστο Βάρος:</label>
            <input type="number" id="maxWeight" name="maxWeight" min="5" max="40" required><br>

            <button id="playButton" onclick="playCustomGame()" disabled>Παίξε</button>
            <div id="error-message" style="color: red; display: none;"></div>
        </div>
    </div>
</div>

<script>
    function showCustomLevelPopup() {
        document.getElementById('customLevelPopup').style.display = 'block';
        localizePopup();
    }

    function closeCustomLevelPopup() {
        document.getElementById('customLevelPopup').style.display = 'none';
    }

    function updateEdgeConstraints() {
        const vertices = parseInt(document.getElementById('vertices').value);
        const maxEdges = (vertices * (vertices - 1)) / 2;
        document.getElementById('edges').min = vertices + 2;
        document.getElementById('edges').max = maxEdges;
        checkInputs();
    }

    function checkInputs() {
        const vertices = document.getElementById('vertices').value;
        const edges = document.getElementById('edges').value;
        const minWeight = document.getElementById('minWeight').value;
        const maxWeight = document.getElementById('maxWeight').value;

        if (vertices && edges && minWeight && maxWeight) {
            document.getElementById('playButton').disabled = false;
        } else {
            document.getElementById('playButton').disabled = true;
        }
    }

    function playGame(level) {
        const currentLanguage = localStorage.getItem('language') || 'el';
        const langSuffix = currentLanguage === 'en' ? 'en' : 'el';
        window.location.href = `/main-game-kruskal?level=${level}`;
    }

    function playCustomGame() {
        const currentLanguage = localStorage.getItem('language') || 'el';
        const langSuffix = currentLanguage === 'en' ? 'en' : 'el';

        const vertices = parseInt(document.getElementById('vertices').value);
        const edges = parseInt(document.getElementById('edges').value);
        const minWeight = parseInt(document.getElementById('minWeight').value);
        const maxWeight = parseInt(document.getElementById('maxWeight').value);

        const maxEdges = (vertices * (vertices - 1)) / 2;

        // Messages differ based on language
        const invalidVerticesMsg = currentLanguage === 'en' ?
            "Invalid input: Number of vertices must be between 5 and 25." :
            "Μη έγκυρη είσοδος: Ο αριθμός των κορυφών πρέπει να είναι μεταξύ 5 και 25.";

        const invalidEdgesMsg = currentLanguage === 'en' ?
            `Invalid input: Number of edges must be between ${vertices + 2} and ${maxEdges} for ${vertices} vertices.` :
            `Μη έγκυρη είσοδος: Ο αριθμός των ακμών πρέπει να είναι μεταξύ ${vertices + 2} και ${maxEdges} για ${vertices} κορυφές.`;

        const invalidWeightsMsg = currentLanguage === 'en' ?
            "Invalid input: Weights must be between 5 and 40." :
            "Μη έγκυρη είσοδος: Τα βάρη πρέπει να είναι μεταξύ 5 και 40.";

        const minGreaterThanMaxMsg = currentLanguage === 'en' ?
            "Invalid input: Minimum weight cannot be greater than maximum weight." :
            "Μη έγκυρη είσοδος: Το ελάχιστο βάρος δεν μπορεί να είναι μεγαλύτερο από το μέγιστο βάρος.";

        if (vertices < 5 || vertices > 25) {
            showErrorMessage(invalidVerticesMsg);
            return;
        }
        if (edges < vertices + 2 || edges > maxEdges) {
            showErrorMessage(invalidEdgesMsg);
            return;
        }
        if (minWeight < 5 || minWeight > 40 || maxWeight < 5 || maxWeight > 40) {
            showErrorMessage(invalidWeightsMsg);
            return;
        }
        if (minWeight > maxWeight) {
            showErrorMessage(minGreaterThanMaxMsg);
            return;
        }

        window.location.href = `/main-game-kruskal?level=custom&vertices=${vertices}&edges=${edges}&minWeight=${minWeight}&maxWeight=${maxWeight}`;
    }

    function showErrorMessage(message) {
        const errorMessageDiv = document.getElementById('error-message');
        errorMessageDiv.innerText = message;
        errorMessageDiv.style.display = 'block';
    }

    function localizePopup() {
        const currentLanguage = localStorage.getItem('language') || 'el';

        const popupTitle = document.getElementById('popup-title');
        const labelVertices = document.getElementById('label-vertices');
        const labelEdges = document.getElementById('label-edges');
        const labelMinWeight = document.getElementById('label-minWeight');
        const labelMaxWeight = document.getElementById('label-maxWeight');
        const playButton = document.getElementById('playButton');

        if (currentLanguage === 'en') {
            popupTitle.textContent = "Create Custom Level";
            labelVertices.textContent = "Number of Vertices:";
            labelEdges.textContent = "Number of Edges:";
            labelMinWeight.textContent = "Minimum Weight:";
            labelMaxWeight.textContent = "Maximum Weight:";
            playButton.textContent = "Play";
        } else {
            popupTitle.textContent = "Δημιουργία Προσαρμοσμένου Επιπέδου";
            labelVertices.textContent = "Αριθμός Κορυφών:";
            labelEdges.textContent = "Αριθμός Ακμών:";
            labelMinWeight.textContent = "Ελάχιστο Βάρος:";
            labelMaxWeight.textContent = "Μέγιστο Βάρος:";
            playButton.textContent = "Παίξε";
        }
    }

    document.getElementById('vertices').addEventListener('input', checkInputs);
    document.getElementById('edges').addEventListener('input', checkInputs);
    document.getElementById('minWeight').addEventListener('input', checkInputs);
    document.getElementById('maxWeight').addEventListener('input', checkInputs);
</script>
</body>
</html>
